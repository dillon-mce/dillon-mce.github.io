<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Stop Throwing Away Errors | Develop with Dillon</title><meta name=keywords content="iOS,Xcode,Swift,Debugging"><meta name=description content="We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the &ldquo;happy path&rdquo;. Maybe we&rsquo;re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don&rsquo;t care so much about the edge cases or what will happen when things go wrong."><meta name=author content><link rel=canonical href=https://dillon-mce.com/posts/dont-throw-away-errors/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ae9017796fc0b71882930de374a7047229b17dd0004f5e7d194bd3dc1413bee5.css integrity="sha256-rpAXeW/AtxiCkw3jdKcEcimxfdAAT159GUvT3BQTvuU=" rel="preload stylesheet" as=style><link rel=icon href=https://dillon-mce.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dillon-mce.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dillon-mce.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dillon-mce.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dillon-mce.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-YZRJY88933"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YZRJY88933")</script><meta property="og:title" content="Stop Throwing Away Errors"><meta property="og:description" content="We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the &ldquo;happy path&rdquo;. Maybe we&rsquo;re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don&rsquo;t care so much about the edge cases or what will happen when things go wrong."><meta property="og:type" content="article"><meta property="og:url" content="https://dillon-mce.com/posts/dont-throw-away-errors/"><meta property="og:image" content="https://dillon-mce.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-27T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-27T00:00:00+00:00"><meta property="og:site_name" content="Develop with Dillon"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dillon-mce.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Stop Throwing Away Errors"><meta name=twitter:description content="We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the &ldquo;happy path&rdquo;. Maybe we&rsquo;re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don&rsquo;t care so much about the edge cases or what will happen when things go wrong."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://dillon-mce.com/posts/"},{"@type":"ListItem","position":3,"name":"Stop Throwing Away Errors","item":"https://dillon-mce.com/posts/dont-throw-away-errors/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Stop Throwing Away Errors","name":"Stop Throwing Away Errors","description":"We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the \u0026ldquo;happy path\u0026rdquo;. Maybe we\u0026rsquo;re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don\u0026rsquo;t care so much about the edge cases or what will happen when things go wrong.","keywords":["iOS","Xcode","Swift","Debugging"],"articleBody":"We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the “happy path”. Maybe we’re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don’t care so much about the edge cases or what will happen when things go wrong.\nIn an exploratory phase this is usually fine. Maybe you’re writing a little script to solve some problem for yourself and no one else has to deal with it. Maybe you’re just trying to figure out how something works and this code will never see the light of day anyways. Whatever the reason, it is probably ok to not handle all the edge cases and errors at first.\nBut one place I see a lot of newer iOS developers get stuck is when they think they’ve got the code for the happy path written, they go to run it, and it just… doesn’t… work.\nI had a psychology professor who used to say “When people don’t know what to do, they do what they know how to do.” He was saying it in the context of people with various addictions, but it is true of all people, and this is another good example. When newer devs get stuck here, they will reach for tools they are familiar with. They will add print statements and set break points and try to narrow down where the problem is. Sometimes this helps. It depends on where the bug is coming from. But there are many types of bugs that these tools are not particularly helpful in solving. One of those areas is in decoding.\nI have lost count of the number of newer developers I have helped figure out decoding bugs, and I often see the same mistake. They throw away errors that would help them track down the bug. In this article we’re going to look at some decoding bugs. They are a good example of a class of bug where the errors that are thrown are often the best tool for understanding what has gone wrong. It also happens to be a context where it is fairly easy to show a few specific examples, so it works well for an article of this size. But the message is true everywhere. Errors and the messages they carry are there for a reason and they are often a helpful tool for finding bugs and making your code more robust.\nSo don’t throw them away!\nLet’s look at a specific example. To protect the egos of the various people I have helped with decoding bugs over the years (at least one of whom now works at Apple), I have made a sample project instead of using someone’s actual code. But it is illustrative of the exact kinds of issues I have seen people run into in the real world.\nSample App Overview My sample app lets you look up random characters from the television show “Bob’s Burgers”. You can tap a button and it will load in a random character, show you their picture, their name, occupation and who voiced the character. There is also a link to the fandom wiki for that character. It uses this api to fetch the information. Here’s how it is organized:\nThere is a character model:\nstruct Character: Codable { let id: Int let name: String let image: URL let occupation: String let voicedBy: String let wikiUrl: URL enum CodingKeys: String, CodingKey { case id, name, image, occupation case voicedBy = \"voiced_by\" case wikiUrl = \"wiki_url\" } } There is a class that encapsulates access to the api with this interface:\nclass BobsBurgersApi { static let shared = BobsBurgersApi() func fetchCharacter(id: Int) async -\u003e Character? { ... } } There is a view model that interacts with the api and provides the primitive building blocks for the view to display:\n@MainActor class CharacterViewModel: ObservableObject { @Published var character: Character? var title: String { character?.name ?? \"\" } var subtitle: String { character?.occupation ?? \"\" } var detail: String { (character?.voicedBy).map { \"Voiced by: \\($0)\" } ?? \"\" } var learnMore: URL { character?.wikiUrl ?? URL(string: \"https://bobs-burgers.fandom.com\")! } private var api: BobsBurgersApi { .shared } func changeCharacter() { Task { character = await api.fetchCharacter(id: .random(in: 1...501)) } } } And finally there is a SwiftUI view that shows the information:\nstruct CharacterView: View { @StateObject var viewModel = CharacterViewModel() var body: some View { VStack { AsyncImage(url: viewModel.character?.image) { phase in phase.image?.resizable() } .aspectRatio(contentMode: .fit) .frame(width: 300, height: 300, alignment: .center) Spacer() Text(viewModel.title) .font(.title) Text(viewModel.subtitle) Text(viewModel.detail) .font(.caption) if !viewModel.title.isEmpty { Link(\"Learn More\", destination: viewModel.learnMore) .font(.caption) } Button(\"New Character\") { viewModel.changeCharacter() }.padding() } .multilineTextAlignment(.center) .padding() } } I’m only loosely familiar with SwiftUI and I used this opportunity to explore it a little bit, so I am sure there are better/more idiosyncratic/efficient ways to write this view, but it isn’t really the point of this article. Any SwiftUI experts out there, feel free to let me know how I could improve this. If I like it better than what I’ve written I’ll up date this article and credit you (if you would like me to).\nFixing the Decoding Now that you have an overview of the app as a whole, let’s take a deeper look at how the decoding is working currently. Here’s where we’re starting:\n// in BobsBurgersApi private static let baseUrl = URL(string: \"https://bobsburgers-api.herokuapp.com\")! func fetchCharacter(id: Int) async -\u003e Character? { let url = Self.baseUrl .appendingPathComponent(\"character\") .appendingPathComponent(\"\\(id)\") guard let (data, _) = try? await URLSession.shared.data(from: url) else { return nil } let character = try? JSONDecoder().decode(Character.self, from: data) return character } Very often I will come across code that is written like this, at least at first. The logic is fairly straightforward.\nIt builds the url by appending “character” and the given id to the api’s base url It tries to get the data from that url It tries to make a Character from that data If it is successful, it returns that character otherwise it returns nil Right now, we’ll find that this always fails to load a character and we don’t get any feedback. So, reaching for familiar tools, we might add print statements like this:\nfunc fetchCharacter(id: Int) async -\u003e Character? { let url = Self.baseUrl .appendingPathComponent(\"character\") .appendingPathComponent(\"\\(id)\") guard let (data, _) = try? await URLSession.shared.data(from: url) else { print(\"Couldn't fetch data\") return nil } let character = try? JSONDecoder().decode(Character.self, from: data) if character == nil { print(\"Couldn't decode character\") } return character } // prints: Couldn't decode character This helps us a tiny bit, because now we can see that it is the decoding that is failing and not fetching the data, but it doesn’t tell us anything about why it is failing. Next, we could try printing the data itself out with something like this:\nif character == nil { print(String(data: data, encoding: .utf8)!) } // prints: {\"error\":\"Error while retreiving data with id 157 in route character.\"} Again this is a little more helpful. And in this case, it is enough to track down the problem. The api is not returning a character model. This is not a decoding problem, but either a problem with the server or with the request we are making. Looking back at the documentation I notice that the route is actually /characters/:id, not character/:id. So we update our code to use “characters” and now it prints:\n{\"id\":3,\"name\":\"Adam\",\"image\":\"https://bobsburgers-api.herokuapp.com/images/characters/3.jpg\",\"gender\":\"Male\",\"hairColor\":\"Brown\",\"relatives\":[{\"name\":\"Unnamed wife\"}],\"firstEpisode\":\"\\\"Mr. Lonely Farts\\\"\",\"voicedBy\":\"Brian Huskey\",\"url\":\"https://bobsburgers-api.herokuapp.com/characters/3\",\"wikiUrl\":\"https://bobs-burgers.fandom.com/wiki/Adam\"} So now we get an actual character model back, but the decoding is still failing. What is the problem?\nWe could look through the keys and values one by one and make sure they line up with the Character struct that we have defined. This could work in this context because it is a relatively small model, but it can get very cumbersome if you are fetching a long list or a large/complex model. A better way (and the point of this whole article) is to use the error we get to give us some clues. So lets modify our fetchCharacter function to catch those errors instead of throwing them away and turning things in to optionals. Now it looks like this:\nfunc fetchCharacter(id: Int) async -\u003e Character? { let url = Self.baseUrl .appendingPathComponent(\"characters\") .appendingPathComponent(\"\\(id)\") do { let (data, _) = try await URLSession.shared.data(from: url) let character = try JSONDecoder().decode(Character.self, from: data) return character } catch { print(error) return nil } } // note that this code is basically the same amount of code as we had before // so don't try to use concision as a reason throw away errors And it prints this when we run it:\nkeyNotFound(CodingKeys(stringValue: \"voiced_by\", intValue: nil), Swift.DecodingError.Context(codingPath: [], debugDescription: \"No value associated with key CodingKeys(stringValue: \\\"voiced_by\\\", intValue: nil) (\\\"voiced_by\\\").\", underlyingError: nil)) This may look intimidating (and that might be the reason many newer developers discard these errors), but it isn’t as bad as it may seem and it is here to help. The error is keyNotFound and if we look a little further we see that the key it couldn’t find is \"voiced_by\". So if we hop back over to the documentation and scroll down to the “Character Schema”, we see that the key is actually called \"voicedBy\". At the same time we might notice that the one we have defined as \"wiki_url\" is actually \"wikiUrl\". (If we didn’t happen to notice, the error would tell us the next time we ran it.)\nSo let’s fix that, and re-run. In this case we can actually just get rid of the CodingKeys enum because all of our property names match the keys in the JSON.\n//enum CodingKeys: String, CodingKey { // case id, name, image, occupation // case voicedBy = \"voiced_by\" // case wikiUrl = \"wiki_url\" //} Now we can re-run and see some actual characters on screen!\nHowever, if you tap through characters long enough, you’ll find that some of them fail to decode. Let’s see what the errors have to say:\nkeyNotFound(CodingKeys(stringValue: \"voicedBy\", intValue: nil), Swift.DecodingError.Context(codingPath: [], debugDescription: \"No value associated with key CodingKeys(stringValue: \\\"voicedBy\\\", intValue: nil) (\\\"voicedBy\\\").\", underlyingError: nil)) Interesting. It is the same error as before, only now we know that we have the key name right. Back to the documentation! Down in the “Character Schema” section we can see:\nKey Type Description voicedBy string | undefined The voice actor for the character That is this api’s way of communicating that voicedBy will be a String if there is one, or it will be undefined (or nil) if there isn’t. In Swift that is actually a different type that we call an optional string (String?, or Optional), so let’s update our model. While we’re at it, let’s check if anything else should be optional.\nThe only other one I see is occupation, so we’ll update that one as well. Now our model looks like this:\nstruct Character: Codable { let id: Int let name: String let image: URL let occupation: String? let voicedBy: String? let wikiUrl: URL } Now, we can tap through Bob’s Burger’s characters to our heart’s content and the decoding should never fail. But if it did, we’d still be printing that error to the console and should be able to track down the issue quickly.\nNested Example I noticed in the docs that some characters have a relatives array. If a certain character has known relatives who are also in the system, it will return them in an array of a slimmed down character model. That seems like interesting information, so let’s add it to our app.\nI’ll call this version of the model Relative to make it clear what we’re dealing with:\nextension Character { struct Relative: Codable { let name: String let wikiUrl: URL let url: URL } } // in Character struct let relatives: [Relative]? Then, so we can see the relatives on screen, I’ll add a new property to the view model and display it on the view:\n// in CharacterViewModel var subtitle2: String { let relatives = character?.relatives?.map(\\.name).joined(separator: \", \") return relatives.map { \"Relatives: \\($0)\" } ?? \"\" } // in CharacterView, after subtitle if !viewModel.subtitle2.isEmpty { Text(viewModel.subtitle2) } Now, if you tap through characters, you’ll find that many of them don’t have relatives but the ones that do will show up in that list. Occasionally though, you’ll find one that will fail decoding and it will print something like this error:\nkeyNotFound(CodingKeys(stringValue: \"wikiUrl\", intValue: nil), Swift.DecodingError.Context(codingPath: [CodingKeys(stringValue: \"relatives\", intValue: nil), _JSONKey(stringValue: \"Index 0\", intValue: 0)], debugDescription: \"No value associated with key CodingKeys(stringValue: \\\"wikiUrl\\\", intValue: nil) (\\\"wikiUrl\\\").\", underlyingError: nil)) It may take a little more effort to get to the bottom of what this error is talking about. It says that it can’t find a wikiUrl and we might be tempted to think that is the wikiUrl on our Character model, because it has one of those. But if we keep reading, we can see in the DecodingError.Context that it is looking at the key relatives (which we know is an array), at the 0th index item (meaning the first item in the array), and there it can’t find a key called wikiUrl. That means that the first relative in our array doesn’t have a wikiUrl.\nThis is an interesting one because the docs say that wikiUrl is non-optional, but apparently it is. I printed out the json for this character and here is what it returns for relatives:\n\"relatives\" : [ { \"name\" : \"Unnamed child\" } ] Apparently, there is at least one Relative who doesn’t have a wikiUrl or a url, which we can account for in our model by making those optional (or just not decoding them, since we aren’t using them).\nstruct Relative: Codable { let name: String let wikiUrl: URL? let url: URL? } struct Relative: Codable { let name: String // let wikiUrl: URL // let url: URL } This is a good reminder that the docs are a good place to start, but they aren’t always up to date. If you have access to the developer who is maintaining the backend, it would be good to alert them to the discrepancy so they can either bring the backend logic up to spec or update the docs to match the actual logic. Or, if it is an open source API, you could open an Issue and/or make a contribution!\nYou can see from this slightly more complex example that these errors are helpful for getting to the root issue even if the problem is deeply nested in your JSON. They may not be in the most human-readable form, but it is possible to work your way down them and gain valuable insights. And, as with most things, you’ll get better with practice and will eventually be able to skim them to get everything you need.\nWrap up The examples in this simple app may seem trivial, but they are reflective of the sort of debugging that is common to work through when you’re trying to get a new network interface up and running. I have seen people spend lots of time trying to work out what is wrong with their decoding and come up with all sorts of odd and complex ways to try to pinpoint the problem. But as we have looked at today, errors, while they might seem intimidating and hard to read at first, are often full of helpful information that tells us exactly what the problem is.\nSo next time you’re tempted to throw that error away, don’t!\nLet me know your opinions on errors and when/when not to use them. And find the full starter project on this branch and the full finished product on this branch.\nPost Scripts Not all errors are as helpful in debugging your code as they are in the context of decoding. Just as a screw driver is very helpful for driving screws, but less so for driving nails, errors are helpful for tracking down and fixing some problems and less so for others. My intention here was just to point out that they are a useful tool and that they are often overlooked by newer developers. Part of growing as a developer is learning the tools that are available to you and over time you will develop a sense of which one(s) will be helpful in different situations.\nAnother thing that we did not explore in this article is when/how to communicate to the user that some error has occurred. This will depend on your content/context and a little bit on personal taste. But generally speaking it is good practice to throw errors up the chain at least to the layer where your business logic lives. That way you at least have the information there and can make decisions about how to handle it in ways that make sense for your app.\n","wordCount":"2813","inLanguage":"en","datePublished":"2022-08-27T00:00:00Z","dateModified":"2022-08-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://dillon-mce.com/posts/dont-throw-away-errors/"},"publisher":{"@type":"Organization","name":"Develop with Dillon","logo":{"@type":"ImageObject","url":"https://dillon-mce.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dillon-mce.com accesskey=h title="Devlop with Dillon (Alt + H)"><img src=https://dillon-mce.com/apple-touch-icon.png alt=logo aria-label=logo height=35>Devlop with Dillon</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://dillon-mce.com/ title=Home><span>Home</span></a></li><li><a href=https://dillon-mce.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dillon-mce.com/cv title=CV><span>CV</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Stop Throwing Away Errors</h1><div class=post-meta><span title='2022-08-27 00:00:00 +0000 UTC'>August 27, 2022</span>&nbsp;·&nbsp;14 min&nbsp;|&nbsp;<a class=muted href=https://github.com/dillon-mce/dillon-mce.github.io/blob/main/content/posts/dont-throw-away-errors/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>We all know how it goes when we are trying to get something working. We want to get there as fast as we can and we get focused on the &ldquo;happy path&rdquo;. Maybe we&rsquo;re not that familiar with the technology/language/concept, but we have one specific goal or task we are trying to achieve and we don&rsquo;t care so much about the edge cases or what will happen when things go wrong.</p><p>In an exploratory phase this is usually fine. Maybe you&rsquo;re writing a little script to solve some problem for yourself and no one else has to deal with it. Maybe you&rsquo;re just trying to figure out how something works and this code will never see the light of day anyways. Whatever the reason, it is probably ok to not handle all the edge cases and errors at first.</p><p>But one place I see a lot of newer iOS developers get stuck is when they think they&rsquo;ve got the code for the happy path written, they go to run it, and it just&mldr; doesn&rsquo;t&mldr; work.</p><p>I had a psychology professor who used to say &ldquo;When people don&rsquo;t know what to do, they do what they know how to do.&rdquo; He was saying it in the context of people with various addictions, but it is true of all people, and this is another good example. When newer devs get stuck here, they will reach for tools they are familiar with. They will add <code>print</code> statements and set break points and try to narrow down where the problem is. Sometimes this helps. It depends on where the bug is coming from. But there are many types of bugs that these tools are not particularly helpful in solving. One of those areas is in decoding.</p><p>I have lost count of the number of newer developers I have helped figure out decoding bugs, and I often see the same mistake. <strong>They throw away errors that would help them track down the bug.</strong> In this article we&rsquo;re going to look at some decoding bugs. They are a good example of a class of bug where the errors that are thrown are often the best tool for understanding what has gone wrong. It also happens to be a context where it is fairly easy to show a few specific examples, so it works well for an article of this size. But the message is true everywhere. Errors and the messages they carry are there for a reason and they are often a helpful tool for finding bugs and making your code more robust.</p><p>So don&rsquo;t throw them away!</p><p>Let&rsquo;s look at a specific example. To protect the egos of the various people I have helped with decoding bugs over the years (at least one of whom now works at Apple), I have made a sample project instead of using someone&rsquo;s actual code. But it is illustrative of the exact kinds of issues I have seen people run into in the real world.</p><h2 id=sample-app-overview>Sample App Overview<a hidden class=anchor aria-hidden=true href=#sample-app-overview>#</a></h2><p>My sample app lets you look up random characters from the television show &ldquo;Bob&rsquo;s Burgers&rdquo;. You can tap a button and it will load in a random character, show you their picture, their name, occupation and who voiced the character. There is also a link to the fandom wiki for that character. It uses <a href=https://bobs-burgers-api-ui.herokuapp.com>this api</a> to fetch the information. Here&rsquo;s how it is organized:</p><p>There is a character model:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Character</span>: Codable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> id: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> name: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> image: URL
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> occupation: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> voicedBy: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> wikiUrl: URL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>CodingKeys</span>: String, CodingKey {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> id, name, image, occupation
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> voicedBy = <span style=color:#e6db74>&#34;voiced_by&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> wikiUrl = <span style=color:#e6db74>&#34;wiki_url&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is a class that encapsulates access to the api with this interface:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BobsBurgersApi</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> shared = BobsBurgersApi()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fetchCharacter</span>(id: Int) async -&gt; Character? { ... }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is a view model that interacts with the api and provides the primitive building blocks for the view to display:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>@MainActor
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CharacterViewModel</span>: ObservableObject {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Published <span style=color:#66d9ef>var</span> character: Character?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> title: String { character?.name ?? <span style=color:#e6db74>&#34;&#34;</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> subtitle: String { character?.occupation ?? <span style=color:#e6db74>&#34;&#34;</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> detail: String { (character?.voicedBy).map { <span style=color:#e6db74>&#34;Voiced by: </span><span style=color:#e6db74>\(</span>$0<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span> } ?? <span style=color:#e6db74>&#34;&#34;</span> }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> learnMore: URL { character?.wikiUrl ?? URL(string: <span style=color:#e6db74>&#34;https://bobs-burgers.fandom.com&#34;</span>)<span style=color:#f92672>!</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> api: BobsBurgersApi { .shared }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>changeCharacter</span>() {
</span></span><span style=display:flex><span>        Task {
</span></span><span style=display:flex><span>            character = await api.fetchCharacter(id: .random(<span style=color:#66d9ef>in</span>: <span style=color:#ae81ff>1.</span>..<span style=color:#ae81ff>501</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And finally there is a <code>SwiftUI</code> view that shows the information:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>CharacterView</span>: View {
</span></span><span style=display:flex><span>    @StateObject <span style=color:#66d9ef>var</span> viewModel = CharacterViewModel()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            AsyncImage(url: viewModel.character?.image) { phase <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                phase.image?.resizable()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            .aspectRatio(contentMode: .fit)
</span></span><span style=display:flex><span>            .frame(width: <span style=color:#ae81ff>300</span>, height: <span style=color:#ae81ff>300</span>, alignment: .center)
</span></span><span style=display:flex><span>            Spacer()
</span></span><span style=display:flex><span>            Text(viewModel.title)
</span></span><span style=display:flex><span>                .font(.title)
</span></span><span style=display:flex><span>            Text(viewModel.subtitle)
</span></span><span style=display:flex><span>            Text(viewModel.detail)
</span></span><span style=display:flex><span>                .font(.caption)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>viewModel.title.isEmpty {
</span></span><span style=display:flex><span>                Link(<span style=color:#e6db74>&#34;Learn More&#34;</span>, destination: viewModel.learnMore)
</span></span><span style=display:flex><span>                    .font(.caption)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;New Character&#34;</span>) {
</span></span><span style=display:flex><span>                viewModel.changeCharacter()
</span></span><span style=display:flex><span>            }.padding()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .multilineTextAlignment(.center)
</span></span><span style=display:flex><span>        .padding()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>I&rsquo;m only loosely familiar with SwiftUI and I used this opportunity to explore it a little bit, so I am sure there are better/more idiosyncratic/efficient ways to write this view, but it isn&rsquo;t really the point of this article. Any SwiftUI experts out there, feel free to let me know how I could improve this. If I like it better than what I&rsquo;ve written I&rsquo;ll up date this article and credit you (if you would like me to).</em></p><h2 id=fixing-the-decoding>Fixing the Decoding<a hidden class=anchor aria-hidden=true href=#fixing-the-decoding>#</a></h2><p>Now that you have an overview of the app as a whole, let&rsquo;s take a deeper look at how the decoding is working currently. Here&rsquo;s where we&rsquo;re starting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// in BobsBurgersApi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> baseUrl = URL(string: <span style=color:#e6db74>&#34;https://bobsburgers-api.herokuapp.com&#34;</span>)<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fetchCharacter</span>(id: Int) async -&gt; Character? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> url = <span style=color:#66d9ef>Self</span>.baseUrl
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;character&#34;</span>)
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>id<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> (data, <span style=color:#66d9ef>_</span>) = <span style=color:#66d9ef>try</span>? await URLSession.shared.data(from: url) <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> character = <span style=color:#66d9ef>try</span>? JSONDecoder().decode(Character.<span style=color:#66d9ef>self</span>, from: data)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> character
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Very often I will come across code that is written like this, at least at first. The logic is fairly straightforward.</p><ol><li>It builds the url by appending &ldquo;character&rdquo; and the given id to the api&rsquo;s base url</li><li>It tries to get the data from that url</li><li>It tries to make a <code>Character</code> from that data</li><li>If it is successful, it returns that character otherwise it returns <code>nil</code></li></ol><p>Right now, we&rsquo;ll find that this always fails to load a character and we don&rsquo;t get any feedback. So, reaching for familiar tools, we might add print statements like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fetchCharacter</span>(id: Int) async -&gt; Character? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> url = <span style=color:#66d9ef>Self</span>.baseUrl
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;character&#34;</span>)
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>id<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> (data, <span style=color:#66d9ef>_</span>) = <span style=color:#66d9ef>try</span>? await URLSession.shared.data(from: url) <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Couldn&#39;t fetch data&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> character = <span style=color:#66d9ef>try</span>? JSONDecoder().decode(Character.<span style=color:#66d9ef>self</span>, from: data)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> character == <span style=color:#66d9ef>nil</span> { print(<span style=color:#e6db74>&#34;Couldn&#39;t decode character&#34;</span>) }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> character
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// prints: Couldn&#39;t decode character</span>
</span></span></code></pre></div><p>This helps us a tiny bit, because now we can see that it is the decoding that is failing and not fetching the data, but it doesn&rsquo;t tell us anything about <em>why</em> it is failing. Next, we could try printing the data itself out with something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>if</span> character == <span style=color:#66d9ef>nil</span> { print(String(data: data, encoding: .utf8)<span style=color:#f92672>!</span>) }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// prints: {&#34;error&#34;:&#34;Error while retreiving data with id 157 in route character.&#34;}</span>
</span></span></code></pre></div><p>Again this is a little more helpful. And in this case, it is enough to track down the problem. The api is not returning a character model. This is not a decoding problem, but either a problem with the server or with the request we are making. Looking back at <a href=https://bobs-burgers-api-ui.herokuapp.com/documentation#characters>the documentation</a> I notice that the route is actually <code>/characters/:id</code>, not <code>character/:id</code>. So we update our code to use &ldquo;characters&rdquo; and now it prints:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{&#34;id&#34;:3,&#34;name&#34;:&#34;Adam&#34;,&#34;image&#34;:&#34;https://bobsburgers-api.herokuapp.com/images/characters/3.jpg&#34;,&#34;gender&#34;:&#34;Male&#34;,&#34;hairColor&#34;:&#34;Brown&#34;,&#34;relatives&#34;:[{&#34;name&#34;:&#34;Unnamed wife&#34;}],&#34;firstEpisode&#34;:&#34;\&#34;Mr. Lonely Farts\&#34;&#34;,&#34;voicedBy&#34;:&#34;Brian Huskey&#34;,&#34;url&#34;:&#34;https://bobsburgers-api.herokuapp.com/characters/3&#34;,&#34;wikiUrl&#34;:&#34;https://bobs-burgers.fandom.com/wiki/Adam&#34;}
</span></span></code></pre></div><p>So now we get an actual character model back, but the decoding is still failing. What is the problem?</p><p>We could look through the keys and values one by one and make sure they line up with the <code>Character</code> struct that we have defined. This could work in this context because it is a relatively small model, but it can get very cumbersome if you are fetching a long list or a large/complex model. A better way (and the point of this whole article) is to use the error we get to give us some clues. So lets modify our <code>fetchCharacter</code> function to catch those errors instead of throwing them away and turning things in to optionals. Now it looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fetchCharacter</span>(id: Int) async -&gt; Character? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> url = <span style=color:#66d9ef>Self</span>.baseUrl
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;characters&#34;</span>)
</span></span><span style=display:flex><span>        .appendingPathComponent(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\(</span>id<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> (data, <span style=color:#66d9ef>_</span>) = <span style=color:#66d9ef>try</span> await URLSession.shared.data(from: url)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> character = <span style=color:#66d9ef>try</span> JSONDecoder().decode(Character.<span style=color:#66d9ef>self</span>, from: data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> character
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>        print(error)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// note that this code is basically the same amount of code as we had before</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// so don&#39;t try to use concision as a reason throw away errors</span>
</span></span></code></pre></div><p>And it prints this when we run it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>keyNotFound(CodingKeys(stringValue: &#34;voiced_by&#34;, intValue: nil), Swift.DecodingError.Context(codingPath: [], debugDescription: &#34;No value associated with key CodingKeys(stringValue: \&#34;voiced_by\&#34;, intValue: nil) (\&#34;voiced_by\&#34;).&#34;, underlyingError: nil))
</span></span></code></pre></div><p>This may look intimidating (and that might be the reason many newer developers discard these errors), but it isn&rsquo;t as bad as it may seem and it is here to help. The error is <code>keyNotFound</code> and if we look a little further we see that the key it couldn&rsquo;t find is <code>"voiced_by"</code>. So if we hop back over to <a href=https://bobs-burgers-api-ui.herokuapp.com/documentation#characters>the documentation</a> and scroll down to the &ldquo;Character Schema&rdquo;, we see that the key is actually called <code>"voicedBy"</code>. At the same time we might notice that the one we have defined as <code>"wiki_url"</code> is actually <code>"wikiUrl"</code>. (If we didn&rsquo;t happen to notice, the error would tell us the next time we ran it.)</p><p>So let&rsquo;s fix that, and re-run. In this case we can actually just get rid of the <code>CodingKeys</code> enum because all of our property names match the keys in the JSON.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>//enum CodingKeys: String, CodingKey {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    case id, name, image, occupation</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    case voicedBy = &#34;voiced_by&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    case wikiUrl = &#34;wiki_url&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//}</span>
</span></span></code></pre></div><p>Now we can re-run and see some actual characters on screen!</p><figure><img loading=lazy src=bobs-characters.png alt="Screenshots showing the app running and properly displaying characters from Bob's Burgers."></figure><p>However, if you tap through characters long enough, you&rsquo;ll find that some of them fail to decode. Let&rsquo;s see what the errors have to say:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>keyNotFound(CodingKeys(stringValue: &#34;voicedBy&#34;, intValue: nil), Swift.DecodingError.Context(codingPath: [], debugDescription: &#34;No value associated with key CodingKeys(stringValue: \&#34;voicedBy\&#34;, intValue: nil) (\&#34;voicedBy\&#34;).&#34;, underlyingError: nil))
</span></span></code></pre></div><p>Interesting. It is the same error as before, only now we know that we have the key name right. Back to <a href=https://bobs-burgers-api-ui.herokuapp.com/documentation#characters>the documentation</a>! Down in the &ldquo;Character Schema&rdquo; section we can see:</p><table><thead><tr><th>Key</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>voicedBy</td><td>string | undefined</td><td>The voice actor for the character</td></tr></tbody></table><p>That is this api&rsquo;s way of communicating that <code>voicedBy</code> will be a <code>String</code> if there is one, or it will be undefined (or <code>nil</code>) if there isn&rsquo;t. In Swift that is actually a different type that we call an optional string (<code>String?</code>, or <code>Optional&lt;String></code>), so let&rsquo;s update our model. While we&rsquo;re at it, let&rsquo;s check if anything else should be optional.</p><p>The only other one I see is <code>occupation</code>, so we&rsquo;ll update that one as well. Now our model looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Character</span>: Codable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> id: Int
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> name: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> image: URL
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> occupation: String?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> voicedBy: String?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> wikiUrl: URL
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, we can tap through Bob&rsquo;s Burger&rsquo;s characters to our heart&rsquo;s content and the decoding should never fail. But if it did, we&rsquo;d still be printing that error to the console and should be able to track down the issue quickly.</p><h2 id=nested-example>Nested Example<a hidden class=anchor aria-hidden=true href=#nested-example>#</a></h2><p>I noticed in the docs that some characters have a <code>relatives</code> array. If a certain character has known relatives who are also in the system, it will return them in an array of a slimmed down character model. That seems like interesting information, so let&rsquo;s add it to our app.</p><p>I&rsquo;ll call this version of the model <code>Relative</code> to make it clear what we&rsquo;re dealing with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Character</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Relative</span>: Codable {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> name: String
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> wikiUrl: URL
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> url: URL
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// in Character struct</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> relatives: [Relative]?
</span></span></code></pre></div><p>Then, so we can see the relatives on screen, I&rsquo;ll add a new property to the view model and display it on the view:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// in CharacterViewModel</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> subtitle2: String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> relatives = character?.relatives?.map(<span style=color:#960050;background-color:#1e0010>\</span>.name).joined(separator: <span style=color:#e6db74>&#34;, &#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> relatives.map { <span style=color:#e6db74>&#34;Relatives: </span><span style=color:#e6db74>\(</span>$0<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span> } ?? <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// in CharacterView, after subtitle</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>viewModel.subtitle2.isEmpty {
</span></span><span style=display:flex><span>    Text(viewModel.subtitle2)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, if you tap through characters, you&rsquo;ll find that many of them don&rsquo;t have relatives but the ones that do will show up in that list. Occasionally though, you&rsquo;ll find one that will fail decoding and it will print something like this error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>keyNotFound(CodingKeys(stringValue: &#34;wikiUrl&#34;, intValue: nil), Swift.DecodingError.Context(codingPath: [CodingKeys(stringValue: &#34;relatives&#34;, intValue: nil), _JSONKey(stringValue: &#34;Index 0&#34;, intValue: 0)], debugDescription: &#34;No value associated with key CodingKeys(stringValue: \&#34;wikiUrl\&#34;, intValue: nil) (\&#34;wikiUrl\&#34;).&#34;, underlyingError: nil))
</span></span></code></pre></div><p>It may take a little more effort to get to the bottom of what this error is talking about. It says that it can&rsquo;t find a <code>wikiUrl</code> and we might be tempted to think that is the <code>wikiUrl</code> on our <code>Character</code> model, because it has one of those. But if we keep reading, we can see in the <code>DecodingError.Context</code> that it is looking at the key <code>relatives</code> (which we know is an array), at the 0th index item (meaning the first item in the array), and there it can&rsquo;t find a key called <code>wikiUrl</code>. That means that the first relative in our array doesn&rsquo;t have a <code>wikiUrl</code>.</p><p>This is an interesting one because <a href=https://bobs-burgers-api-ui.herokuapp.com/documentation#characters>the docs</a> say that <code>wikiUrl</code> is non-optional, but apparently it is. I printed out the json for this character and here is what it returns for <code>relatives</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&#34;relatives&#34; : [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        &#34;name&#34; : &#34;Unnamed child&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>Apparently, there is at least one <code>Relative</code> who doesn&rsquo;t have a <code>wikiUrl</code> or a <code>url</code>, which we can account for in our model by making those optional (or just not decoding them, since we aren&rsquo;t using them).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Relative</span>: Codable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> name: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> wikiUrl: URL?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> url: URL?
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Relative</span>: Codable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> name: String
</span></span><span style=display:flex><span><span style=color:#75715e>//    let wikiUrl: URL</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    let url: URL</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>This is a good reminder that the docs are a good place to start, but they aren&rsquo;t always up to date. If you have access to the developer who is maintaining the backend, it would be good to alert them to the discrepancy so they can either bring the backend logic up to spec or update the docs to match the actual logic. Or, if it is an open source API, you could open an Issue and/or make a contribution!</em></p><p>You can see from this slightly more complex example that these errors are helpful for getting to the root issue even if the problem is deeply nested in your JSON. They may not be in the most human-readable form, but it is possible to work your way down them and gain valuable insights. And, as with most things, you&rsquo;ll get better with practice and will eventually be able to skim them to get everything you need.</p><h2 id=wrap-up>Wrap up<a hidden class=anchor aria-hidden=true href=#wrap-up>#</a></h2><p>The examples in this simple app may seem trivial, but they are reflective of the sort of debugging that is common to work through when you&rsquo;re trying to get a new network interface up and running. I have seen people spend lots of time trying to work out what is wrong with their decoding and come up with all sorts of odd and complex ways to try to pinpoint the problem. But as we have looked at today, errors, while they might seem intimidating and hard to read at first, are often full of helpful information that tells us exactly what the problem is.</p><p>So next time you&rsquo;re tempted to throw that error away, <a href=https://media.giphy.com/media/IRkqguqMTKUne/giphy.gif>don&rsquo;t!</a></p><p>Let me know your opinions on errors and when/when not to use them. And find the full starter project on <a href=https://github.com/dillon-mce/dont-throw-away-errors/tree/starter-project>this branch</a> and the full finished product on <a href=https://github.com/dillon-mce/dont-throw-away-errors>this branch</a>.</p><h2 id=post-scripts>Post Scripts<a hidden class=anchor aria-hidden=true href=#post-scripts>#</a></h2><p>Not all errors are as helpful in debugging your code as they are in the context of decoding. Just as a screw driver is very helpful for driving screws, but less so for driving nails, errors are helpful for tracking down and fixing some problems and less so for others. My intention here was just to point out that they <em>are</em> a useful tool and that they are often overlooked by newer developers. Part of growing as a developer is learning the tools that are available to you and over time you will develop a sense of which one(s) will be helpful in different situations.</p><p>Another thing that we did not explore in this article is when/how to communicate to the user that some error has occurred. This will depend on your content/context and a little bit on personal taste. But generally speaking it is good practice to throw errors up the chain at least to the layer where your business logic lives. That way you at least have the information there and can make decisions about how to handle it in ways that make sense for your app.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dillon-mce.com/tags/ios/>iOS</a></li><li><a href=https://dillon-mce.com/tags/xcode/>Xcode</a></li><li><a href=https://dillon-mce.com/tags/swift/>Swift</a></li><li><a href=https://dillon-mce.com/tags/debugging/>Debugging</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Stop Throwing Away Errors on twitter" href="https://twitter.com/intent/tweet/?text=Stop%20Throwing%20Away%20Errors&url=https%3a%2f%2fdillon-mce.com%2fposts%2fdont-throw-away-errors%2f&hashtags=iOS%2cXcode%2cSwift%2cDebugging"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Stop Throwing Away Errors on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdillon-mce.com%2fposts%2fdont-throw-away-errors%2f&title=Stop%20Throwing%20Away%20Errors&summary=Stop%20Throwing%20Away%20Errors&source=https%3a%2f%2fdillon-mce.com%2fposts%2fdont-throw-away-errors%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Stop Throwing Away Errors on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdillon-mce.com%2fposts%2fdont-throw-away-errors%2f&title=Stop%20Throwing%20Away%20Errors"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></div></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2022 <a href=https://dillon-mce.com>Dillon McElhinney</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>